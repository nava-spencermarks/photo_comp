{% extends "base.html" %}

{% block content %}
<div class="card" x-data="photoComparisonApp">
    <form method="POST" action="{{ url_for('compare_faces') }}" enctype="multipart/form-data" @submit="handleFormSubmit($event)">
        <div class="image-container">
            <div class="image-box">
                <h3>First Image</h3>
                <div class="upload-area">
                    <div class="form-group">
                        <label for="image1">Choose first image:</label>
                        <input type="file" id="image1" name="image1" class="file-input"
                               accept="image/*" required
                               @change="handleImageChange($event, 1)">
                    </div>
                    <p class="upload-hint">
                        Supported formats: PNG, JPG, JPEG, GIF, BMP
                    </p>
                </div>
                <div class="image-canvas-container" id="canvas-container-1"
                     :style="image1.containerVisible ? 'display: block' : 'display: none'">
                    <div class="image-wrapper">
                        <img id="preview1" class="image-preview">
                        <canvas id="canvas1" class="canvas-overlay"
                                @mousedown="handleMouseDown($event, 1)"
                                @mousemove="handleMouseMove($event, 1)"
                                @mouseup="handleMouseUp($event, 1)"
                                @mouseleave="handleMouseLeave($event, 1)"></canvas>
                    </div>
                    <div class="canvas-controls">
                        <div class="mask-controls">
                            <div class="mask-controls-title">Quick Presets:</div>
                            <div class="mask-buttons preset-buttons">
                                <button type="button"
                                        class="preset-btn preset-btn-eyes"
                                        :class="{ 'active': isPresetActive('eyes') }"
                                        @click="togglePreset('eyes', 1)">üëÅÔ∏è Eyes</button>
                                <button type="button"
                                        class="preset-btn preset-btn-nose"
                                        :class="{ 'active': isPresetActive('nose') }"
                                        @click="togglePreset('nose', 1)">üëÉ Nose</button>
                            </div>

                            <div class="mask-controls-title" style="margin-top: 1rem;">Individual Masks:</div>
                            <div class="mask-buttons">
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_top') }"
                                        @click="toggleMask('rect_top', 1)">Top Bar</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_middle') }"
                                        @click="toggleMask('rect_middle', 1)">Middle Bar</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_bottom') }"
                                        @click="toggleMask('rect_bottom', 1)">Bottom Bar</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_left') }"
                                        @click="toggleMask('rect_left', 1)">Left Side</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_right') }"
                                        @click="toggleMask('rect_right', 1)">Right Side</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_center') }"
                                        @click="toggleMask('rect_center', 1)">Center</button>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button type="button"
                                    class="btn-small btn-clear-masks btn-red"
                                    @click="clearAllMasks(1)">üóëÔ∏è Clear All</button>
                            <button type="button"
                                    class="btn-small btn-flip-image btn-purple"
                                    @click="flipImage('preview1')">üîÑ Flip Upside Down</button>
                        </div>
                        <div class="mask-hint">
                            <div>Click buttons to add rectangle masks</div>
                            <div class="mask-hint-detail">
                                Active masks show with darker buttons
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="image-box">
                <h3>Second Image</h3>
                <div class="upload-area">
                    <div class="form-group">
                        <label for="image2">Choose second image:</label>
                        <input type="file" id="image2" name="image2" class="file-input"
                               accept="image/*" required
                               @change="handleImageChange($event, 2)">
                    </div>
                    <p class="upload-hint">
                        Supported formats: PNG, JPG, JPEG, GIF, BMP
                    </p>
                </div>
                <div class="image-canvas-container" id="canvas-container-2"
                     :style="image2.containerVisible ? 'display: block' : 'display: none'">
                    <div class="image-wrapper">
                        <img id="preview2" class="image-preview">
                        <canvas id="canvas2" class="canvas-overlay"
                                @mousedown="handleMouseDown($event, 2)"
                                @mousemove="handleMouseMove($event, 2)"
                                @mouseup="handleMouseUp($event, 2)"
                                @mouseleave="handleMouseLeave($event, 2)"></canvas>
                    </div>
                    <div class="canvas-controls">
                        <div class="mask-controls">
                            <div class="mask-controls-title">Quick Presets:</div>
                            <div class="mask-buttons preset-buttons">
                                <button type="button"
                                        class="preset-btn preset-btn-eyes"
                                        :class="{ 'active': isPresetActive('eyes') }"
                                        @click="togglePreset('eyes', 2)">üëÅÔ∏è Eyes</button>
                                <button type="button"
                                        class="preset-btn preset-btn-nose"
                                        :class="{ 'active': isPresetActive('nose') }"
                                        @click="togglePreset('nose', 2)">üëÉ Nose</button>
                            </div>

                            <div class="mask-controls-title" style="margin-top: 1rem;">Individual Masks:</div>
                            <div class="mask-buttons">
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_top') }"
                                        @click="toggleMask('rect_top', 2)">Top Bar</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_middle') }"
                                        @click="toggleMask('rect_middle', 2)">Middle Bar</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_bottom') }"
                                        @click="toggleMask('rect_bottom', 2)">Bottom Bar</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_left') }"
                                        @click="toggleMask('rect_left', 2)">Left Side</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_right') }"
                                        @click="toggleMask('rect_right', 2)">Right Side</button>
                                <button type="button"
                                        class="mask-btn mask-btn-purple"
                                        :class="{ 'active': isMaskActive('rect_center') }"
                                        @click="toggleMask('rect_center', 2)">Center</button>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button type="button"
                                    class="btn-small btn-clear-masks btn-red"
                                    @click="clearAllMasks(2)">üóëÔ∏è Clear All</button>
                            <button type="button"
                                    class="btn-small btn-flip-image btn-purple"
                                    @click="flipImage('preview2')">üîÑ Flip Upside Down</button>
                        </div>
                        <div class="mask-hint">
                            <div>Click buttons to add rectangle masks</div>
                            <div class="mask-hint-detail">
                                Active masks show with darker buttons
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="submit-section">
            <button type="submit" class="btn">
                üîç Compare Faces
            </button>
        </div>
    </form>
</div>

<div class="card">
    <h3 class="instructions-title">How it works:</h3>
    <ol class="instructions-list">
        <li>Upload two images containing faces</li>
        <li>Our AI analyzes the facial features in both images</li>
        <li>Get instant results showing if it's the same person</li>
        <li>View detailed comparison metrics</li>
    </ol>
</div>

<!-- Alpine.js App Component -->
<script src="{{ url_for('static', filename='js/alpine-app.js') }}"></script>
{% endblock %}
