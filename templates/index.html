{% extends "base.html" %}

{% block content %}
<div class="card">
    <form method="POST" action="{{ url_for('compare_faces') }}" enctype="multipart/form-data">
        <div class="image-container">
            <div class="image-box">
                <h3>First Image</h3>
                <div class="upload-area">
                    <div class="form-group">
                        <label for="image1">Choose first image:</label>
                        <input type="file" id="image1" name="image1" class="file-input" 
                               accept="image/*" required>
                    </div>
                    <p style="color: #666; font-size: 0.9rem;">
                        Supported formats: PNG, JPG, JPEG, GIF, BMP
                    </p>
                </div>
                <div class="image-canvas-container" id="canvas-container-1" style="display: none;">
                    <div style="position: relative; display: inline-block; margin: 0 auto;">
                        <img id="preview1" style="max-width: 300px; max-height: 300px; border-radius: 6px; transition: transform 0.3s ease; display: block;">
                        <canvas id="canvas1" style="position: absolute; top: 0; left: 0; cursor: move;"></canvas>
                    </div>
                    <div class="canvas-controls">
                        <div style="margin-bottom: 1rem;">
                            <div style="font-weight: bold; margin-bottom: 0.5rem; color: #555;">Mask Areas:</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_top', 1)" style="background: #667eea;">Top Bar</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_middle', 1)" style="background: #667eea;">Middle Bar</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_bottom', 1)" style="background: #667eea;">Bottom Bar</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_left', 1)" style="background: #667eea;">Left Side</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_right', 1)" style="background: #667eea;">Right Side</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_center', 1)" style="background: #667eea;">Center</button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" class="btn-small" onclick="clearAllMasks(1)" style="background: #f44336;">üóëÔ∏è Clear All</button>
                            <button type="button" class="btn-small" onclick="flipImage('preview1')" style="background: #667eea;">üîÑ Flip Upside Down</button>
                        </div>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">
                            <div>Click buttons to add rectangle masks</div>
                            <div style="margin-top: 0.3rem; font-size: 0.7rem; color: #888;">
                                Active masks show with darker buttons
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="image-box">
                <h3>Second Image</h3>
                <div class="upload-area">
                    <div class="form-group">
                        <label for="image2">Choose second image:</label>
                        <input type="file" id="image2" name="image2" class="file-input" 
                               accept="image/*" required>
                    </div>
                    <p style="color: #666; font-size: 0.9rem;">
                        Supported formats: PNG, JPG, JPEG, GIF, BMP
                    </p>
                </div>
                <div class="image-canvas-container" id="canvas-container-2" style="display: none;">
                    <div style="position: relative; display: inline-block; margin: 0 auto;">
                        <img id="preview2" style="max-width: 300px; max-height: 300px; border-radius: 6px; transition: transform 0.3s ease; display: block;">
                        <canvas id="canvas2" style="position: absolute; top: 0; left: 0; cursor: move;"></canvas>
                    </div>
                    <div class="canvas-controls">
                        <div style="margin-bottom: 1rem;">
                            <div style="font-weight: bold; margin-bottom: 0.5rem; color: #555;">Mask Areas:</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_top', 2)" style="background: #667eea;">Top Bar</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_middle', 2)" style="background: #667eea;">Middle Bar</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_bottom', 2)" style="background: #667eea;">Bottom Bar</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_left', 2)" style="background: #667eea;">Left Side</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_right', 2)" style="background: #667eea;">Right Side</button>
                                <button type="button" class="mask-btn" onclick="toggleMask('rect_center', 2)" style="background: #667eea;">Center</button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" class="btn-small" onclick="clearAllMasks(2)" style="background: #f44336;">üóëÔ∏è Clear All</button>
                            <button type="button" class="btn-small" onclick="flipImage('preview2')" style="background: #667eea;">üîÑ Flip Upside Down</button>
                        </div>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">
                            <div>Click buttons to add rectangle masks</div>
                            <div style="margin-top: 0.3rem; font-size: 0.7rem; color: #888;">
                                Active masks show with darker buttons
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <button type="submit" class="btn">
                üîç Compare Faces
            </button>
        </div>
    </form>
</div>

<div class="card">
    <h3 style="margin-bottom: 1rem; color: #555;">How it works:</h3>
    <ol style="color: #666; line-height: 1.6;">
        <li>Upload two images containing faces</li>
        <li>Our AI analyzes the facial features in both images</li>
        <li>Get instant results showing if it's the same person</li>
        <li>View detailed comparison metrics</li>
    </ol>
</div>

<!-- External JavaScript Files -->
<script src="{{ url_for('static', filename='js/rectangle-patterns.js') }}"></script>
<script src="{{ url_for('static', filename='js/mask-state.js') }}"></script>
<script src="{{ url_for('static', filename='js/mask-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/mouse-handlers.js') }}"></script>
<script src="{{ url_for('static', filename='js/mask-operations.js') }}"></script>
<script src="{{ url_for('static', filename='js/image-preview.js') }}"></script>
<script src="{{ url_for('static', filename='js/form-submission.js') }}"></script>
{% endblock %}